
### Script Usage :



```
[ec2-user@ip-172-31-8-156 scripts]$ sh check_mysql_mem_temp_status.sh -u <User> -p$pass -h <MySQL Hostname>
=== MySQL TempStorageEngine 利用状況分析 ===
実行時刻: Tue Nov 11 01:54:48 UTC 2025

--- 現在の設定 ---
+----------------------+-----------------------+-------------------+--------------------+
| temptable_max_ram_GB | temptable_max_mmap_GB | tmp_table_size_MB | tmp_storage_engine |
+----------------------+-----------------------+-------------------+--------------------+
|       1.000000000000 |        1.000000000000 |       16.00000000 | TempTable          |
+----------------------+-----------------------+-------------------+--------------------+

--- TempTable メモリ使用状況 ---
+--------------------------------+-------------+------------+-----------+----------+--------------------+--------------+-----------------+------------+
| EVENT_NAME                     | COUNT_ALLOC | COUNT_FREE | SUM_ALLOC | SUM_FREE | CURRENT_COUNT_USED | CURRENT_USED | HIGH_COUNT_USED | HIGH_USED  |
+--------------------------------+-------------+------------+-----------+----------+--------------------+--------------+-----------------+------------+
| memory/temptable/physical_disk |           2 |          2 | 1.00 GiB  | 1.00 GiB |                  0 |    0 bytes   |               2 | 1.00 GiB   |
| memory/temptable/physical_ram  |        4275 |       4266 | 4.70 GiB  | 4.69 GiB |                  9 | 9.00 MiB     |              22 | 524.00 MiB |
+--------------------------------+-------------+------------+-----------+----------+--------------------+--------------+-----------------+------------+

--- 分析とアドバイス ---
+--------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                               RAM上限: 1.00 GB |
|                                                                                                              MMAP上限: 1.00 GB |
|                                                                                                          tmp_table_size: 16 MB |
|                                                                                                  ストレージエンジン: TempTable |
|                                                                                                                            --- |
|                                                                                                  ✅ RAM使用率: 51.2% - 正常範囲 |
|                                                     ? ディスク使用検出 (最大: 1.00 GiB) - クエリ最適化またはRAM/MMAP増加が必要 |
|                                                                                                                            --- |
|                 ? tmp_table_size (16MB) が小さい - 64MB以上を推奨 ※Aurora: aurora_tmptable_enable_per_table_limit=ON時のみ有効 |
|                                                                                                      ✅ TempTableエンジン使用中 |
+--------------------------------------------------------------------------------------------------------------------------------+

--- 推奨アクション ---
• 高RAM使用率: SET GLOBAL temptable_max_ram = <新しい値>;
• 高MMAP使用率: SET GLOBAL temptable_max_mmap = <新しい値>;
• 小さいtmp_table_size: SET GLOBAL tmp_table_size = 67108864; (64MB) ※Aurora: aurora_tmptable_enable_per_table_limit=ON時のみ有効
• ディスク使用: クエリのJOIN/GROUP BY/ORDER BYを最適化
• 継続監視: このスクリプトを定期実行してトレンドを把握


```
